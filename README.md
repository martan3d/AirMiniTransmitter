# AirMiniTransmitter
The project's overall purpose is to provide a low-cost DCC-compatible transmitter and receiver using open-source software that operates on [Airwire(TM)](http://www.cvpusa.com/airwire_system.php) channels 0-16 in the 902-928 MHz "ISM" band. A special S-Cab compatible channel 17 has been added to operate in this band. The older Tam Valley Depot DRS, Mk III receiver/amplifier, and the NCE D13DRJ wireless decoder will also operate on this channel or channel 16. Also, the code has now been modified to operate in the European "868MHz" ISM band @869.85MHz, designated Channel 18. We have verified the compatibility of the ProMiniAir transmitter/receiver with the Tam Valley Depot DRS 1 European receiver/transmitter operating at this frequency.

The code has been updated to use transceivers that operate in the European 434MHz ISM band to improve range performance using a "repeater." The base station _transmits_ wireless DCC at 434MHz, and a fixed-location repeater, consisting of a 434MHz _receiver_ whose 5V DCC output is directly connected to an 869.85MHz _transmitter_, in turn provides wireless DCC transmissions to mobile 869.85MHz _receivers_ onboard a locomotive. The 434MHz ISM band is impractical as a "stand-alone" transmitter-receiver solution because the antennas are too long for mobile receivers. 

Transceiver settings have been devised and tested in the 2.4GHz ISM band for the TI CC2500 transceiver operating at a base frequency of 2.433GHz. This ISM band has worldwide regulatory approval and provides numerous channels. Currently, the channels are separated by 310kHz and are designated 0-7.

The project's hardware target is the ["ProMiniAir"](https://oscaledeadrail.com/building-the-promini-air-wireless-dcc-transmitter-receiver/) transmitter/receiver hardware developed by [OScaleDeadRail](https://oscaledeadrail.com). The original MCU hardware was an [Arduino Pro Mini controller](https://smile.amazon.com/gp/product/B015MGHLNA/ref=ppx_yo_dt_b_search_asin_title?ie=UTF8&psc=1) and a [PCB that hosts the Texas Instruments CC1101 transceiver](https://smile.amazon.com/coolxan-Wireless-Transceiver-RF1100SE-Antenna/dp/B00MNI4792/ref=pd_rhf_dp_p_img_9?_encoding=UTF8&psc=1&refRID=2KY8W2G0TDXEASJPFMG6) that are widely available. Interfacing to an ["I2C" OLED](https://www.amazon.com/gp/product/B01KNKTM2I/ref=ppx_yo_dt_b_search_asin_title?ie=UTF8&psc=1) for diagnostics is provided. LCD support is maintained for backward compatibility. 

The latest hardware uses an Atmega328P mounted on the PCB (1.1"x0.76") with the transceiver. For the latest [EasyEda](https://easyeda.com/) PCB designs, see the [pcb] (https://github.com/martan3d/AirMiniTransmitter/tree/master/pcb/EasyEda) directory.

The ProMiniAir *transmitter* connects to any standard DCC throttle/controller through a straightforward DCC converter circuit (2 diodes and one resistor) described in the [Users Manual](https://github.com/martan3d/AirMiniTransmitter/blob/master/doc/AirMini_Users_Manual.pdf) and transmits DCC waveforms that can be received by any DCC-compatible receiver on Airwire(TM) channels 0-16 and the "European" channel 17 (@869.85MHz). Compatible receivers include the Airwire(TM) CONVRTR (Airwire channels 0-16); Tam Valley Depot DRS1, Mark III and IV (Airwire channels 0-16, S-Cab channel 17, and European channel 18 @ 869.85MHz); QSI Solutions GWire (Airwire channels 0-8); and the ProMiniAir receiver (Airwire channels 0-16, S-Cab channel 17, and European channel 18 @ 869.85MHz). The ProMiniAir transmitter satisfies the unique requirements of the Airwire(TM) CONVRTR for very long preambles (about 30 pulses) added to the "garden-variety" DCC packets produced by typical DCC throttles/controllers.

The ProMiniAir *transmitter* is easily and inexpensively integrated with a WiFi-equipped [EX-CommandStation](https://dcc-ex.com/ex-commandstation/index.html) developed by the very active [DCC-EX](https://dcc-ex.com/) group as a *completely stand-alone* transmitter solution using a smartphone [throttle app](https://dcc-ex.com/throttles/software/index.html) to connect to the ProMiniAir transmitter for dead-rail control. See [this link](https://oscaledeadrail.com/2022/08/28/a-low-cost-wifi-equipped-dcc-base-station-for-the-promini-air-transmitter/) for details.

The ProMiniAir *receiver* shares the identical PCB as the ProMiniAir transmitter (with jumper-only changes for how power is provided), and changing only the #define in [libraries/config/config.h](https://github.com/martan3d/AirMiniTransmitter/blob/master/libraries/config/config.h) will create a receiver version of the hardware. On start-up, the ProMiniAir receiver will search for a valid DCC signal on the default channel (stored in EEPROM). If a valid DCC packet is not found on this channel, then the ProMiniAir will search for valid DCC on Airwire channels in the following order: 0, 18(EU), 17, 1, 2, 3, ..., 15, 16. This search will help ensure that if a Tam Valley transmitter is used, the ProMiniAir receiver will "find" it quickly on channel 18(EU) or 17. Depending on the default frequency specified in config.h, if the ProMiniAir receiver does not find a valid channel, it will wait at this default frequency for a valid transmission. This default channel should usually be 0 (for North America) or 18 (for Europe). 

As described at the [OScaleDeadRail site](https://oscaledeadrail.com), an inexpensive but powerful amplifier (13A), the [Cytron MD13S](https://smile.amazon.com/gp/product/B07CW3GRL6/ref=ppx_yo_dt_b_search_asin_title?ie=UTF8&psc=1), is available to convert the ProMiniAir receiver's 5V "logic-level" DCC to "bipolar" DCC for the onboard DCC decoder. Also, a small (1.0"x0.8") [DRV8871 amplifier (3.6A)](https://www.adafruit.com/product/3190) can be used as well.

The ProMini transmitter/receiver can be configured like any mobile decoder by accessing its DCC address (default: 9900(Transmitter)/9901(Receiver)) in "OPS" mode and changing Configuration Variable (CV) values described in the documentation. Example settings that can be changed via DCC OPS mode include default transmit/receive channel (CV255=0-17), transmission power (CV254=0-10), "factory" reset (CV8=8), use short or long address (CV29=0 or 32), short address (CV3), long address (CV17 and CV18). The I2C display, if connected, will be found automatically regardless of its address, usually 39 (0x27) or 63 (0x3F).

The project has been updated to operate with CC1101 (or CC110L) transceiver boards that operate at 27MHz (such as the FCC/IC/ETSI-approved Anaren boards) or 26 MHz (such as the FCC/ETSI-approved [Ebyte E07-900M10S](https://www.cdebyte.com/products/E07-900M10S)). Selection is performed by editing [libraries/config/config.h](https://github.com/martan3d/AirMiniTransmitter/blob/master/libraries/config/config.h).

The LiquidCrystal_I2C library in this project has been MODIFIED: a) the LiquidCrystal_I2C declaration now has no arguments, so it can be declared global in scope without requiring arguments, and b) adding address and sizing arguments to the init method to access EEPROM data, which is by necessity inside a function call. THIS MODIFIED LIBRARY MUST BE USED WITH THIS PROJECT - THE "VANILLA" LiquidCrystal_I2C LIBRARY WILL NOT WORK! Our thanks to the LiquidCrystal_I2C library developers!

